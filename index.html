<!doctype html>
<html lang="no">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="robots" content="noindex, nofollow" />
  <link href="https://fonts.googleapis.com/css2?family=Mountains+of+Christmas:wght@400;700&display=swap" rel="stylesheet" />
  <title>Markus sin Julekalender</title>
  <style>
    :root{
      /* Farger & fonter */
      --bg:#0c111b; --card:#101827; --text:#eef2f7; --muted:#94a3b8;
      --title-font:'Mountains of Christmas', cursive;
      /* Juler칮de fliser */
      --tile-red-1:#b91c1b;        /* base */
      --tile-red-2:#b91c1b;        /* base (jevnt) */
      --tile-red-1-hover:#da1717;  /* hover lysere */
      --tile-red-2-hover:#da1717;  /* hover lysere */
      --tile-red-dim-1:#4f1c1b;    /* l친st lysere */
      --tile-red-dim-2:#34100f;    /* l친st m칮rkere */
      --tile-border:#6b1f1c;
    }

    *{box-sizing:border-box}
    body{margin:0;-webkit-text-size-adjust:100%;font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Arial;color:var(--text);background:radial-gradient(1200px 600px at 50% -200px,#1b2437,var(--bg));min-height:100dvh}

    header{text-align:center;padding:18px 0 8px}
    header h1{font-family:var(--title-font);font-size:2.4rem;margin:0}
    header p{color:var(--muted);margin:.25rem 0 0}
    @media (min-width:768px){header h1{font-size:2.8rem}}

    /* Feilbanner */
    .banner{display:none;background:#7c2d12;color:#fff;padding:12px 16px;border-radius:10px;margin:14px auto;max-width:900px;text-align:center;font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Arial;font-size:.95rem}

    /* Layout */
    .container{width:min(1100px,92%);margin:0 auto}
    main.container{padding:24px clamp(16px,4vw,28px) 80px}

    .grid{display:grid;grid-template-columns:repeat(4,1fr);gap:32px;padding:20px 0}
    @media (max-width:1024px){.grid{grid-template-columns:repeat(3,1fr)}}
    @media (max-width:700px){.grid{grid-template-columns:repeat(2,1fr)}}
    @media (max-width:380px){.grid{grid-template-columns:1fr}}

    /* Luker */
    .card{position:relative;display:flex;flex-direction:column;align-items:center;justify-content:center;aspect-ratio:1/1;border-radius:22px;border:1.5px solid var(--tile-border);background:linear-gradient(145deg,var(--tile-red-1),var(--tile-red-2));box-shadow:0 10px 24px rgba(0,0,0,.30), inset 0 1px 0 rgba(255,255,255,.06), inset 0 -1px 0 rgba(0,0,0,.25);transition:transform .18s ease, box-shadow .18s ease, background .18s ease;cursor:pointer}
    .card.locked{background:linear-gradient(145deg,var(--tile-red-dim-1),var(--tile-red-dim-2));filter:saturate(.95);cursor:not-allowed}
    @media (hover:hover){.card:not(.locked):hover{transform:scale(1.02);box-shadow:0 14px 36px rgba(0,0,0,.35);background:linear-gradient(145deg,var(--tile-red-1-hover),var(--tile-red-2-hover))}}

    /* Ikon (outline) over tallet */
    .status{display:flex;align-items:center;justify-content:center;margin-bottom:6px}
    .status svg{width:28px;height:28px;stroke:rgba(255,255,255,.95);fill:none;stroke-width:2.2;stroke-linecap:round;stroke-linejoin:round}
    .card.locked .status svg{stroke:rgba(255,255,255,.7)}

    /* Tallet midtstilt, julefont */
    .num{font-family:var(--title-font);font-size:2.6rem;line-height:1;color:#fff;margin:6px 0 0 0;text-shadow:0 1px 0 rgba(0,0,0,.35)}
    .card.locked .num{opacity:.6;filter:brightness(.85)}

    /* Sn칮 bak innholdet */
    .snow{position:fixed;inset:0;z-index:0;pointer-events:none}
    .snow::before,.snow::after{content:"";position:absolute;left:0;top:-50px;width:100%;height:100%;background-image:radial-gradient(2px 2px at 20px 30px,#fff 50%,transparent 51%),radial-gradient(3px 3px at 100px 80px,#fff 50%,transparent 51%),radial-gradient(2px 2px at 200px 50px,#fff 50%,transparent 51%),radial-gradient(3px 3px at 300px 10px,#fff 50%,transparent 51%),radial-gradient(2px 2px at 400px 40px,#fff 50%,transparent 51%);background-size:400px 200px;animation:snow 10s linear infinite;opacity:.75}
    .snow::after{animation-duration:16s;opacity:.5;filter:blur(1px)}
    @keyframes snow{to{transform:translateY(200px)}}

    header,main{position:relative;z-index:1}

    /* Modal for 친pne luker */
    .modal{position:fixed;inset:0;display:grid;place-items:center;background:rgba(0,0,0,.55);padding:16px;z-index:10}
    .modal.hidden{display:none}
    .modal-content{background:var(--card);border:1px solid #263453;border-radius:18px;width:min(720px,96%);padding:18px;position:relative;color:var(--text);display:flex;flex-direction:column;gap:12px;max-height:90dvh;overflow:auto;box-shadow:0 18px 40px rgba(0,0,0,.6)}
    .modal-header{display:flex;align-items:center;justify-content:center}
    .modal-banner{width:100%;border-radius:14px;padding:12px 16px;background:linear-gradient(145deg,var(--tile-red-1),var(--tile-red-2));position:relative;overflow:hidden;box-shadow:0 8px 20px rgba(0,0,0,.35);margin-bottom:4px}
    .modal-banner::before,.modal-banner::after{content:"";position:absolute;left:0;top:-40px;width:100%;height:140%;background-image:radial-gradient(2px 2px at 20px 30px,#fff 55%,transparent 56%),radial-gradient(3px 3px at 140px 40px,#fff 55%,transparent 56%),radial-gradient(2px 2px at 260px 80px,#fff 55%,transparent 56%),radial-gradient(2px 2px at 380px 20px,#fff 55%,transparent 56%);background-size:320px 160px;opacity:.7;pointer-events:none}
    .modal-banner::after{opacity:.4;filter:blur(1px);animation:snow 14s linear infinite}
    .modal-title{position:relative;z-index:1;font-family:var(--title-font);font-size:1.7rem;margin:0;text-align:center;color:#fff;text-shadow:0 1px 0 rgba(0,0,0,.35)}
    @media (max-width:420px){.modal-title{font-size:1.5rem}}
    .modal-text{font-size:1rem;line-height:1.5;margin:0}
    .modal-text p{margin:0 0 0.7em;}
    .btns{display:flex;gap:10px;margin-top:6px;flex-wrap:wrap;justify-content:flex-start}
    .btn{display:inline-flex;align-items:center;gap:8px;padding:10px 14px;border-radius:12px;color:#fff;text-decoration:none;font-weight:700;border:none;cursor:pointer}
    .btn svg{width:18px;height:18px;fill:currentColor}
    .btn-apple{background:#fa233b}
    .btn-spotify{background:#1db954}
    .btn-secondary{background:#374151}
    .btn:focus-visible{outline:3px solid #22c55e;outline-offset:2px}
  </style>
</head>
<body>
  <div class="snow"></div>
  <header class="container">
    <h1>游꾻 Markus sin Julekalender</h1>
    <p>Et lite stykke musikk hver dag fram til jul. En del gleder og kanskje noen utfordringer?</p>
  </header>

  <!-- Feil-/statusbanner (midtstilt) -->
  <div id="err" class="banner"></div>

  <main class="container">
    <div id="grid" class="grid"></div>
  </main>

  <!-- Modal for 친pne luker -->
  <div id="modal" class="modal hidden" role="dialog" aria-modal="true">
    <div class="modal-content">
      <div class="modal-header">
        <div class="modal-banner">
          <h2 id="modal-title" class="modal-title"></h2>
        </div>
      </div>
      <p id="modal-text" class="modal-text"></p>
      <div class="btns">
        <a id="btn-apple" class="btn btn-apple" target="_blank" rel="noopener" aria-label="칀pne i Apple Music">
  Apple Music
</a>
<a id="btn-spotify" class="btn btn-spotify" target="_blank" rel="noopener" aria-label="칀pne i Spotify">
  Spotify
</a>
        <button id="btn-close" class="btn btn-secondary" type="button">Lukk</button>
      </div>
    </div>
  </div>

  <script>
    const FIXED_TEST_DAY = 8; // test: 친pne t.o.m. 8. des.
    const DATA_URLS = ['data/days.json','./data/days.json'];

    const modal = document.getElementById('modal');
    const modalTitle = document.getElementById('modal-title');
    const modalText = document.getElementById('modal-text');
    const btnApple = document.getElementById('btn-apple');
    const btnSpotify = document.getElementById('btn-spotify');
    const btnClose = document.getElementById('btn-close');
    // Formatterer tekst til avsnitt (alternativ 3)
    function formatModalText(raw){
      if(!raw) return '';

      // Escape HTML-tegn s친 vi ikke tolker <, > osv.
      const esc = raw
        .replace(/&/g,'&amp;')
        .replace(/</g,'&lt;')
        .replace(/>/g,'&gt;');

      // Del i avsnitt p친 tomme linjer
      const paragraphs = esc.split(/\n\s*\n/);

      // Lag <p>...</p> for hvert avsnitt
      // og la enkel \n bli til <br>
      return paragraphs
        .map(function(p){
          return '<p>' + p.replace(/\n/g,'<br>') + '</p>';
        })
        .join('');
    }

    function showFriendlyError(){
      const el = document.getElementById('err');
      el.textContent = 'Oisann, det er noe feil her. Send meg en melding, s친 jeg kan se p친 det! I mellomtiden kan du synge en sang selv... 游꾼游낖';
      el.style.display = 'block';
    }

    function placeholderDays(){
      return Array.from({length:24}, (_,i)=>({
        title: `${i+1}. desember`,
        image: `assets/images/day${String(i+1).padStart(2,'0')}.webp`,
        text: '', apple: '', spotify: ''
      }));
    }

    async function fetchJson(url){
      const res = await fetch(url,{cache:'no-store'});
      if(!res.ok) throw new Error('HTTP '+res.status);
      return res.json();
    }

    async function loadDays(){
      for(const url of DATA_URLS){
        try{
          const data = await fetchJson(url);
          if(Array.isArray(data) && data.length){
            const base = placeholderDays();
            return base.map((d,idx)=>({ ...d, ...(data[idx]||{}) }));
          }
        }catch(e){/* pr칮v neste */}
      }
      showFriendlyError();
      return placeholderDays();
    }

    function openModal(day,item){
      const title = item && (item.title || item.date) ? (item.title || item.date) : `${day}. desember`;
      modalTitle.textContent = title;
      modalText.innerHTML = formatModalText(item && item.text ? item.text : '');

      if(item && item.apple){
        btnApple.href = item.apple;
        btnApple.style.display = 'inline-flex';
      }else{
        btnApple.style.display = 'none';
      }
      if(item && item.spotify){
        btnSpotify.href = item.spotify;
        btnSpotify.style.display = 'inline-flex';
      }else{
        btnSpotify.style.display = 'none';
      }

      modal.classList.remove('hidden');
    }

    function render(days){
      const grid=document.getElementById('grid');
      grid.innerHTML='';
      for(let i=0;i<24;i++){
        const d = days[i] || { title:`${i+1}. desember` };
        const day = i+1;
        const card=document.createElement('button');
        card.className='card'+(day>FIXED_TEST_DAY?' locked':'');
        card.type='button';
        const icon = day<=FIXED_TEST_DAY
          ? `<span class='status' aria-hidden='true'><svg viewBox='0 0 24 24'><path d='M12 2c-.8 0-1.4.6-1.4 1.4v1.6c-2.5.6-4.6 2.8-4.6 5.5 0 3.4-1.4 5-2 5.4h16c-.6-.4-2-2-2-5.4 0-2.7-2.1-4.9-4.6-5.5V3.4c0-.8-.6-1.4-1.4-1.4zM12 22a2 2 0 0 0 2-2h-4a2 2 0 0 0 2 2z'/></svg></span>`
          : `<span class='status' aria-hidden='true'><svg viewBox='0 0 24 24'><rect x='5' y='10' width='14' height='10' rx='2'/><path d='M8 10V8a4 4 0 0 1 8 0v2'/></svg></span>`;
        card.innerHTML = `${icon}<span class='num'>${day}</span>`;
        if(day>FIXED_TEST_DAY){
          card.disabled = true; // ikke klikkbar
        }else{
          card.addEventListener('click',()=>openModal(day,d));
        }
        grid.appendChild(card);
      }
    }

    btnClose.addEventListener('click',()=>modal.classList.add('hidden'));
    modal.addEventListener('click',e=>{ if(e.target===modal) modal.classList.add('hidden'); });

    (async()=>{
      const days=await loadDays();
      render(days);
    })();
  </script>
</body>
</html>
